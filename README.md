# EddyVisual
eddy recognition  and lagrangian visualization


# 基于拉格朗日的涡旋可视化
1. 首先用ROMS或者其它海洋模式模拟出一个涡旋，得到ROMS输出的流场文件（history文件）
2. 把roms输出文件插值到z坐标系
3. 利用传统的涡旋识别算法在roms输出文件中提取出来涡旋边界
4. 对涡旋进行欧拉分析，画出来垂直剖面图，水平剖面图等
5. 根据欧拉分析结果，结合涡旋边界，布放粒子，生成粒子初始位置csv文件
6. 配置拉格朗日粒子追踪实验，设置粒子初始位置文件，流场文件，地形文件路径
7. Map：把配置好的实验分割成多个子任务，映射到多个核上，同时批量提交
8. Reduce：从多个子任务中并行的收集结果，合并结果，下载到本地
9. 分析实验结果，也就是粒子轨迹数据，画图，做Gif


**文件夹Mfiles_yhq和LTRANSv.2b-master下面包含了以上流程的所有代码**
## 文件夹Mfiles_yhq
该文件夹下保存的是以上流程的所有matlab代码，也是matlab运行的当前文件夹，其中：

1.  argo目录下的代码用来从Argo数据里面提取指定区域，时间段，编号的argo轨迹，并且画图，和虚拟粒子轨迹进行对比，以检验roms模拟的准确性
2.  dttest目录下的代码用来做拉格朗日模式的dt敏感性分析
3.  geniniloc目录下的代码用来生成指定位置，特定数量的粒子初始位置
4.  plot目录下的代码用来进行欧拉场分析时画图，分析拉格朗日实验结果画图
5.  src目录下都是被调用的底层函数，不会直接运行它们
6.  主目录下还有很多不好分类的，功能比较综合性的代码，比如画一些比较复杂的图，涡旋边界的提取，roms输出文件的插值，提取并制作定常流场nc文件等等。


## LTRANSv.2b-master
   每一个Model文件夹都是一个单独的实验，可以单独运行。为了提升运行效率而做的并行化，进行定常流场下的粒子追踪，笛卡尔坐标系的引入等新特性。我在官方版本的代码之上进行了很多改写。关于LTRANS的基本情况在[官网](http://northweb.hpl.umces.edu/LTRANS.htm) 上面有介绍，基本用法参考官方 [UserGuide](http://northweb.hpl.umces.edu/LTRANS.htm#Guide).
   
   **新特性：**

1.    并行化：首先利用map.py实现大规模任务到小规模任务的划分，在map.py中需要指出并行数量mapnum（要考虑有多少核是可用的，可以跨计算节点），还需要给出待划分的母实验名称，粒子初始位置文件名。在映射完成后用runall.sh批量提交。等待所有子任务运行结束。所有子任务运行结束之后，利用reduce.py收集所有子任务的结果并合并，注意，在使用reduce.py时，需要提供两个参数，一个是待收集结果的母任务名称，一个是收集结果的命名。
2.    笛卡尔坐标系：修改conversion_module.f90的相应位置，重新make
3.    定常流场：修改hydrodynamic_module.f90的相应位置，重新make

   
   
 
   
   
 
   
   





